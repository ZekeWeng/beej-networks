# Network Programming Structs

## Socket Descriptor
- Type: `int`
- Represents a socket connection in the system
- Used to identify and manage network connections

## Key Structs

### 1. `struct addrinfo`
Used for host name lookups and service name resolution. Contains information about a socket address.

```c
struct addrinfo {
    int  ai_flags;          // Additional options
    int  ai_family;         // Address family (AF_INET, AF_INET6)
    int  ai_socktype;       // Socket type (SOCK_STREAM, SOCK_DGRAM)
    int  ai_protocol;       // Protocol (0 for "any")
    size_t  ai_addrlen;     // Size of ai_addr in bytes
    struct sockaddr *ai_addr; // Socket address structure
    char *canonname;        // Canonical hostname
    struct addrinfo *ai_next; // Next structure in linked list
};
```

### 2. `struct sockaddr`
Generic socket address structure used for type casting.

```c
struct sockaddr {
    unsigned short sa_family;    // Address family (AF_INET, AF_INET6)
    char sa_data[14];           // Protocol address (IP + port)
};
```

### 3. `struct sockaddr_in`
IPv4-specific socket address structure.

```c
struct sockaddr_in {
    short int sin_family;        // AF_INET
    unsigned short int sin_port; // Port number (Network Byte Order)
    struct in_addr sin_addr;     // IPv4 address
    unsigned char sin_zero[8];   // Padding to match sockaddr size
};

struct in_addr {
    uint32_t s_addr;            // 32-bit IPv4 address
};
```

### 4. `struct sockaddr_in6`
IPv6-specific socket address structure.

```c
struct sockaddr_in6 {
    uint16_t sin6_family;       // AF_INET6
    uint16_t sin6_port;         // Port number (Network Byte Order)
    uint32_t sin6_flowinfo;     // IPv6 flow information
    struct in6_addr sin6_addr;  // IPv6 address
    uint32_t sin6_scope_id;     // Scope ID
};

struct in6_addr {
    unsigned char s6_addr[16];  // 128-bit IPv6 address
};
```

### 5. `struct sockaddr_storage`
Large enough to hold both IPv4 and IPv6 addresses.

```c
struct sockaddr_storage {
    sa_family_t ss_family;      // Address family
    char ss_pad1[_SS_PAD1SIZE];
    char ss_align;
    char __ss_pad2[_SS_PAD2SIZE];
};
```

## Important Methods

### 1. `getaddrinfo()`
```c
int getaddrinfo(const char *node, const char *service,
                const struct addrinfo *hints,
                struct addrinfo **res);
```
- Resolves hostnames and service names
- Returns a linked list of `addrinfo` structures
- Can be used for both IPv4 and IPv6
- Returns 0 on success, non-zero on error

### 2. `freeaddrinfo()`
```c
void freeaddrinfo(struct addrinfo *res);
```
- Frees the linked list returned by `getaddrinfo()`

### 3. `gai_strerror()`
```c
const char *gai_strerror(int errcode);
```
- Converts error codes from `getaddrinfo()` to human-readable strings

## Type Casting
- `struct sockaddr` is the generic type
- Can be cast to/from `sockaddr_in` or `sockaddr_in6`
- Example:
```c
struct sockaddr *sa;
struct sockaddr_in *sin = (struct sockaddr_in *)sa;
```

## Best Practices
1. Always use `getaddrinfo()` for address resolution
2. Check `sa_family` before casting
3. Use `sockaddr_storage` when you need to handle both IPv4 and IPv6
4. Remember to convert port numbers to Network Byte Order using `htons()`
5. Initialize padding bytes to zero using `memset()`

## Common Usage Pattern
```c
struct addrinfo hints, *res;
memset(&hints, 0, sizeof hints);
hints.ai_family = AF_UNSPEC;    // IPv4 or IPv6
hints.ai_socktype = SOCK_STREAM; // TCP stream socket
hints.ai_flags = AI_PASSIVE;    // Fill in my IP for me

getaddrinfo(NULL, "3490", &hints, &res);
// Use res...
freeaddrinfo(res);
```
